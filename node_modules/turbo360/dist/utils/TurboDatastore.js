var Promise=require("bluebird"),superagent=require("superagent"),helper=require("./Helper"),TurboDatastore=function(e){var r=e,t=function(r,t){return null==t&&(t={}),new Promise(function(n,o){if(0==helper.validateSiteId(e))return void o(new Error("Please Set Your TURBO_APP_ID"));var i=r.toLowerCase().trim();superagent.get(e.base_url+"/api/"+i).query(t).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.results;n(t)})})},n=function(r,t){return new Promise(function(n,o){if(0==helper.validateSiteId(e))return void o(new Error("Please Set Your TURBO_APP_ID"));var i=r.toLowerCase().trim();superagent.get(e.base_url+"/api/"+i+"/"+t).query(null).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result;n(t)})})},o=function(t,n){return new Promise(function(o,i){if(0==helper.validateSiteId(e))return void i(new Error("Please Set Your TURBO_APP_ID"));if(null==n)return void i(new Error("Post parameters required."));n.site=r.site_id;var a=t.toLowerCase().trim();superagent.post(e.base_url+"/api/"+a).send(n).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void i(e);if("fail"==r.body.confirmation)return void i(new Error(r.body.message));var t=r.body.result||r.body.results;o(t)})})},i=function(r,t,n){return new Promise(function(o,i){if(0==helper.validateSiteId(e))return void i(new Error("Please Set Your TURBO_APP_ID"));if(null==n)return void i(new Error("Updated parameters required."));var a=r.toLowerCase().trim();superagent.put(e.base_url+"/api/"+a+"/"+t).send(n).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void i(e);if("fail"==r.body.confirmation)return void i(new Error(r.body.message));var t=r.body.result||r.body.results;o(t)})})},a=function(r,t){return new Promise(function(n,o){if(0==helper.validateSiteId(e))return void o(new Error("Please Set Your TURBO_APP_ID"));var i=r.toLowerCase().trim();superagent.delete(e.base_url+"/api/"+i+"/"+t).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result||r.body.results;n(t)})})};return{fetch:t,fetchOne:n,create:o,update:function(r,t,n){return new Promise(function(o,i){if(0==helper.validateSiteId(e))return void i(new Error("Please Set Your TURBO_APP_ID"));if(null==n)return void i(new Error("Post parameters required."));Object.keys(n).forEach(function(e,r){var o=n[e];t[e]=o});var a=r.toLowerCase().trim();superagent.put(e.base_url+"/api/"+a+"/"+t.id).send(t).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void i(e);if("fail"==r.body.confirmation)return void i(new Error(r.body.message));var t=r.body.result||r.body.results;o(t)})})},remove:function(r,t){return new Promise(function(n,o){if(0==helper.validateSiteId(e))return void o(new Error("Please Set Your TURBO_APP_ID"));var i=r.toLowerCase().trim();superagent.delete(e.base_url+"/api/"+i+"/"+t.id).set(helper.standardHeaders(e)).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result||r.body.results;n(t)})})},updateEntity:i,removeEntity:a}};module.exports=TurboDatastore;