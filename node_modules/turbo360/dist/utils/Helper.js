var Promise=require("bluebird"),superagent=require("superagent"),cheerio=require("cheerio"),moment=require("moment"),currentSite=null;module.exports={fetchSite:function(e,r){return null==r&&(r=!0),new Promise(function(t,n){if(null!=currentSite&&1==r)return void t(currentSite);var i=e.turbo_url+"/api/site/"+e.site_id;superagent.get(i).query(null).set("Accept","application/json").end(function(e,r){if(e)return void n(e);var i=r.body;if("success"!=i.confirmation)return void n(new Error(i.message));currentSite=i.result,t(currentSite)})})},fetchTextFile:function(e){return new Promise(function(r,t){superagent.get(e).query(null).end(function(e,n){if(e)return void t(e);r(n.text)})})},validateSiteId:function(e){return null!=e.site_id&&("<TURBO_APP_ID>"!=e.site_id&&!(e.site_id.length<20))},standardHeaders:function(e){var r={Accept:"application/json"};return r[e.turbo_app_header]=e.site_id,r},slugify:function(e,r){var t=e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");if(null==r)return t.toLowerCase();if(r<=0)return t.toLowerCase();for(var n="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",u=0;u<r;u++)n+=i.charAt(Math.floor(Math.random()*i.length));return t.toLowerCase()+"-"+n},dateString:function(e){return moment().format(e)},scrapePreview:function(e){$=cheerio.load(e);var r="";return $("p").each(function(e,t){r+=t.children[0].data}),r.length>=200?r.substring(0,200)+"...":r}};