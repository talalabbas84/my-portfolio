"use strict";var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),sessions=require("client-sessions"),db=require("./db"),templateEngine=require("./template-engine");require("dotenv").config();var basePath=__dirname+"/../../../../",defaultConfiguration=function(e){var s=path.join(basePath,"public");e.use(express.static(s));var r=path.join(basePath,"views");e.set("views",r)},configureOptions=function(e,s){if(null!=s){if(null==e)return void defaultConfiguration(s);var r=e.db;null!=r&&(null==r.type?db.connect(r.url,r.onError,r.onSuccess):"mongo"==r.type?db.connectMongo(r.url,r.onError,r.onSuccess):"nedb"==r.type?db.connectNedb(r.url,r.onError,r.onSuccess):db.connectMongo(r.url,r.onError,r.onSuccess));var n=e.views||"views",o=path.join(basePath,n);s.set("views",o);var i=e.static||"public",t=path.join(basePath,i);s.use(express.static(t))}},expressInstance=function(e){var s=express();if(configureOptions(e,s),s.use(bodyParser.json()),s.use(bodyParser.urlencoded({extended:!1})),s.use(cookieParser()),s.use(logger("dev")),process.env.SESSION_SECRET){var r="vertexSession",n=process.env.SESSION_SECRET,o=864e5,i=18e5;null!=e&&null!=e.session&&(r=e.session.cookieName||"vertexSession",n=e.session.secret||process.env.SESSION_SECRET,o=e.session.duration||864e5,i=e.session.activeDuration||18e5),s.use(sessions({cookieName:r,secret:n,duration:o,activeDuration:i}))}return s.set("view engine","mustache"),s.engine("mustache",templateEngine.__express),s};module.exports={express:function(e){return expressInstance(e)},app:function(e){return expressInstance(e)},router:function(){return new express.Router}};